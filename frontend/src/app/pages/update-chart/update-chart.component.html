<div class="update-chart-container">
  <div class="header">
    <button (click)="goBack()" class="back-btn">
      <i class="fa-solid fa-arrow-left"></i> Back
    </button>
    <h2>Update Chart</h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading chart...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <h3>⚠️ Error</h3>
    <p>{{ error }}</p>
    <button (click)="clearError()" class="retry-btn">Dismiss</button>
  </div>

  <!-- Form -->
  <div *ngIf="!isLoading && chart" class="form-container">
    <div class="form-section">
      <h3>Chart Information</h3>
      
      <!-- Recalculation Info Box -->
      <div class="info-box recalculation-notice">
        <i class="fa-solid fa-lightbulb"></i>
        <p>
          <strong>Note:</strong> Updating birth date, time, or location will automatically recalculate 
          all astrological data (Sun Sign, Moon Sign, Rising Sign, and Planetary Positions).
        </p>
      </div>
      
      <div class="form-group">
        <label for="name">Chart Name</label>
        <input
          id="name"
          type="text"
          [(ngModel)]="formData.name"
          placeholder="Enter chart name"
          class="form-input"
        />
        <small class="help-text">Max 200 characters</small>
      </div>

      <div class="form-group">
        <label for="birthDate">Birth Date</label>
        <input
          id="birthDate"
          type="date"
          [(ngModel)]="formData.birthDate"
          (change)="onBirthInfoChange()"
          class="form-input"
        />
        <small class="help-text">Format: YYYY-MM-DD | Changing this will recalculate astrology</small>
      </div>

      <div class="form-group">
        <label for="birthTime">Birth Time</label>
        <input
          id="birthTime"
          type="time"
          [(ngModel)]="formData.birthTime"
          (change)="onBirthInfoChange()"
          class="form-input"
        />
        <small class="help-text">Format: HH:MM (24-hour) | Changing this will recalculate astrology</small>
      </div>

      <div class="form-group">
        <label for="birthLocation">Birth Location</label>
        <input
          id="birthLocation"
          type="text"
          [(ngModel)]="formData.birthLocation"
          (change)="onBirthInfoChange()"
          placeholder="Enter birth location"
          class="form-input"
        />
        <small class="help-text">Between 2 and 200 characters | Changing this will recalculate astrology</small>
      </div>

      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea
          id="notes"
          [(ngModel)]="formData.notes"
          placeholder="Add any notes about this chart"
          class="form-textarea"
          rows="4"
        ></textarea>
        <small class="help-text">Max 1000 characters</small>
      </div>

      <div class="form-group checkbox">
        <label for="isPublic">
          <input
            id="isPublic"
            type="checkbox"
            [(ngModel)]="formData.isPublic"
          />
          Make this chart public
        </label>
      </div>

      <!-- Recalculation Warning -->
      <div *ngIf="hasAstrologyChanges" class="info-box warning-notice">
        <i class="fa-solid fa-triangle-exclamation"></i>
        <div>
          <strong>Astrological Data Will Be Recalculated</strong><br>
          <p style="margin-bottom: 0.5rem;">When you save, the following will be automatically updated based on the new birth information:</p>
          <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
            <li>Sun Sign</li>
            <li>Moon Sign</li>
            <li>Rising Sign</li>
            <li>Planetary Positions (all planets)</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Original Chart Info (Read-only) -->
    <div class="form-section read-only-section">
      <h3>Chart Details (Read-Only)</h3>
      
      <div class="info-grid">
        <div class="info-item">
          <label>Sun Sign</label>
          <p>{{ chart.sunSign }}</p>
        </div>
        <div class="info-item">
          <label>Moon Sign</label>
          <p>{{ chart.moonSign }}</p>
        </div>
        <div class="info-item">
          <label>Rising Sign</label>
          <p>{{ chart.risingSign }}</p>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
      <button (click)="resetForm()" class="btn btn-secondary">
        <i class="fa-solid fa-rotate"></i> Reset
      </button>
      <button (click)="updateChart()" [disabled]="isSubmitting" class="btn btn-primary">
        <span *ngIf="!isSubmitting">
          <i class="fa-solid fa-check"></i> Update Chart
        </span>
        <span *ngIf="isSubmitting">
          <i class="fa-solid fa-spinner fa-spin"></i> Updating...
        </span>
      </button>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="success-state">
      <i class="fa-solid fa-check-circle"></i>
      <p>{{ successMessage }}</p>
    </div>
  </div>
</div>
